{% extends "base.html" %}

{% block content %}
<div class="header" style="margin-bottom: 30px;">
    <h1>Dashboard Overview</h1>
    <p style="color: var(--text-muted);">Welcome back, {{ user.name }}!</p>
</div>

<!-- Summary Cards -->
<div class="stats-grid">
    <div class="card">
        <h3>{{ stats.total }}</h3>
        <p>Total Products</p>
    </div>
    <div class="card">
        <h3 style="color: var(--secondary-color);">{{ stats.fresh }}</h3>
        <p>Fresh Items</p>
    </div>
    <div class="card">
        <h3 style="color: orange;">{{ stats.near_expiry }}</h3>
        <p>Near Expiry</p>
    </div>
    <div class="card">
        <h3 style="color: var(--accent-color);">{{ stats.expired }}</h3>
        <p>Expired / Rotten</p>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-container" style="display: flex; gap: 20px; margin-bottom: 40px; flex-wrap: wrap;">
    <div class="card" style="flex: 1; min-width: 300px;">
        <h4>Freshness Distribution</h4>
        <canvas id="freshnessChart"></canvas>
    </div>
    <div class="card" style="flex: 1; min-width: 300px;">
        <h4>Category Breakdown</h4>
        <canvas id="categoryChart"></canvas>
    </div>
</div>

<!-- Recent Activity -->
<h3>Recent Analysis</h3>
<table class="data-table">
    <thead>
        <tr>
            <th>Date</th>
            <th>Product</th>
            <th>Category</th>
            <th>Freshness</th>
            <th>Expiry Date</th>
        </tr>
    </thead>
    <tbody>
        {% for item in recent_uploads %}
        <tr>
            <td>{{ item.Timestamp }}</td>
            <td>{{ item.Product }}</td>
            <td>{{ item.Category }}</td>
            <td>
                {% if 'Fresh' in item.Freshness %}
                <span style="color: var(--secondary-color); font-weight: bold;"><i class="fas fa-check-circle"></i> {{
                    item.Freshness }}</span>
                {% elif 'Rotten' in item.Freshness %}
                <span style="color: var(--accent-color); font-weight: bold;"><i class="fas fa-times-circle"></i> {{
                    item.Freshness }}</span>
                {% else %}
                <span style="color: orange;">{{ item.Freshness }}</span>
                {% endif %}
            </td>
            <td>{{ item.ExpiryDate }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" style="text-align: center;">No recent data found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
{% endblock %}